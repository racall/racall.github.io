webpackJsonp([1],[,,,,,function(t,e,i){"use strict";i.d(e,"a",function(){return a});var a={api:$("xy").data("api"),myWebstie:"javascritp:;",anonymous:"https://xy.52xyi.cn/tx.png",placeholder:$("xy").data("placeholder")}},,,,function(t,e,i){"use strict";var a=i(23);e.a={getuser:function(t){return a.a.save({openId:t})},saveuser:function(t){return a.b.save(t)},getlist:function(t){return a.c.get({post:t})},savelist:function(t){return a.d.save(t)},dellist:function(t){return a.e.save({id:t})},savedata:function(t){return a.f.save(t)},getdata:function(){return a.g.get()}}},,,,function(t,e,i){"use strict";var a=i(8);e.a=new a.a},function(t,e,i){i(31);var a=i(6)(i(20),i(36),"data-v-fbe0a37c",null);t.exports=a.exports},function(t,e,i){i(29);var a=i(6)(i(22),i(34),"data-v-3d376b93",null);t.exports=a.exports},,,function(t,e,i){i(30);var a=i(6)(i(19),i(35),null,null);t.exports=a.exports},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(25),s=i.n(a),n=i(5),o=i(9),r=i(14),c=i.n(r),l=i(32),u=i.n(l);e.default={name:"app",components:{Comment:c.a,List:u.a},data:function(){return{user:{},show:!1,isMail:!1,isSite:!1,email:"",website:"",openId:"",accessToken:"",config:n.a}},created:function(){console.log("当前登录状态："+QC.Login.check()),localStorage.getItem("user")?QC.Login.check()?this.user=JSON.parse(localStorage.getItem("user")):localStorage.removeItem("user"):QC.Login.check()&&this.queryinfo()},watch:{email:function(){/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(this.email)&&""!=this.email?this.isMail=!1:this.isMail=!0},website:function(){/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/.test(this.website)&&""!=this.website?this.isSite=!1:this.isSite=!0}},methods:{switchLogin:function(){this.show=!this.show},logout:function(){QC.Login.signOut(),QC.Login.check()||(localStorage.removeItem("user"),this.user={})},register:function(){if(this.email&&this.website){QC.Login.check()||QC.Login.showPopup();var t=this;QC.Login({},function(){t.getinfo()})}else alert("需要正确填写信息，才能发布留言哟！")},login:function(){QC.Login.check()||QC.Login.showPopup();var t=this;QC.Login({},function(){t.queryinfo()})},getinfo:function(){var t=this;QC.Login.getMe(function(e,i){t.openId=e,t.accessToken=i,QC.api("get_user_info",{}).success(function(e){t.user={nickname:e.data.nickname,avatar:e.data.figureurl_qq_2,openid:t.openId,email:t.email,website:t.website},t.save()}).error(function(t){console.log("error:"+t),alert("登录失败，请联系管理员！")})})},save:function(){var t=this;o.a.saveuser(this.user).then(function(e){e.body.code?(QC.Login.signOut(),t.email="",t.website="",alert(e.body.msg)):(t.user=e.body.msg,localStorage.setItem("user",s()(t.user)),t.switchLogin())})},queryinfo:function(){var t=this;QC.Login.getMe(function(e,i){t.openId=e,t.accessToken=i,o.a.getuser(e).then(function(e){e.body.code?(alert(e.body.msg),QC.Login.signOut(),t.user={}):(t.user=e.body,localStorage.setItem("user",s()(t.user)))},function(t){console.log("Query user info error:"),console.log(t)})})}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(13),s=i(5),n=i(9),o=i(15),r=i.n(o);e.default={name:"comment",props:["toid","pid","user"],components:{Load:r.a},data:function(){return{content:"",disabled:!1,config:s.a}},created:function(){},methods:{autoTextarea:function(t){t.target.style.height="57px";var e,i=t.target.style;t.target.scrollHeight>57&&(t.target.scrollHeight>210?(e=210,i.overflowY="scroll"):(e=t.target.scrollHeight,i.overflowY="hidden"),i.height=e+"px")},isEmpty:function(t){return t=t.trim(),t.length>0},reply:function(){if(QC.Login.check()){if(localStorage.getItem("user"))if(this.isEmpty(this.content)){var t={},e=this.content;t=void 0===this.toid&&void 0===this.pid?{fromid:this.user._id,content:e,post:$("xy").data("key")}:{fromid:this.user._id,toid:this.toid,pId:this.pid,content:e,post:$("xy").data("key")};var i=this;this.disabled=!0,n.a.savelist(t).then(function(t){i.saveData(t.body._id),i.content="",i.$emit("reload"),a.a.$emit("load"),i.disabled=!1})}else alert("亲，评论内容不能为空哟！")}else alert("亲，你未登录不能评论哟！")},saveData:function(t){var e=this,i={cid:t,url:$("xy").data("url"),OS:e.os(),browser:e.ua()};n.a.savedata(i)},os:function(){var t=navigator.userAgent,e="";return e=t.match(/win/gi)?t.match(/nt 5.1/gi)?"Windows XP":t.match(/nt 6.1/gi)?"Windows 7":t.match(/nt 6.2/gi)?"Windows 8":t.match(/nt 6.3/gi)?"Windows 8.1":t.match(/nt 10.0/gi)?"Windows 10":t.match(/nt 6.0/gi)?"Windows Vista":t.match(/nt 5/gi)?"Windows 2000":"Windows":t.match(/android/gi)?"Android":t.match(/ubuntu/gi)?"Ubuntu":t.match(/linux/gi)?"Linux":t.match(/mac/gi)?"MacOS":t.match(/unix/gi)?"Unix":t.match(/symbian/gi)?"Nokia SymbianOS":"Other OS",e},ua:function(){var t=navigator.userAgent,e="",i=new Array;if(i=t.match(/MSIE\s([^\s|;]+)/gi))e="Internet Explorer|"+i[0];else if(i=t.match(/FireFox\/([^\s]+)/gi)){var a=i[0].split("/");e="Mozilla FireFox|"+a[1]}else if(i=t.match(/Maxthon([\d]*)\/([^\s]+)/gi)){var a=i[0].split("/");e="Maxthon"}else if(i=t.match(/UBrowser([\d]*)\/([^\s]+)/gi)){var a=i[0].split("/");e="UCBrowser|"+a[1]}else if(i=t.match(/MetaSr/gi))e="搜狗浏览器";else if(i=t.match(/2345Explorer/gi))e="2345王牌浏览器";else if(i=t.match(/2345chrome/gi))e="2345加速浏览器";else if(i=t.match(/LBBROWSER/gi))e="猎豹安全浏览器";else if(i=t.match(/MicroMessenger\/([^\s]+)/gi)){var a=i[0].split("/");e="微信|"+a[1]}else if(i=t.match(/QQBrowser\/([^\s]+)/gi)){var a=i[0].split("/");e="QQ浏览器|"+a[1]}else if(i=t.match(/QQ\/([^\s]+)/gi)){var a=i[0].split("/");e="QQ浏览器|"+a[1]}else if(i=t.match(/MiuiBrowser\/([^\s]+)/gi)){var a=i[0].split("/");e="Miui浏览器|"+a[1]}else if(i=t.match(/Chrome([\d]*)\/([^\s]+)/gi)){var a=i[0].split("/");e="Chrome|"+a[1]}else if(i=t.match(/safari\/([^\s]+)/gi)){var a=i[0].split("/");e="Apple Safari|"+a[1]}else if(i=t.match(/Opera[\s|\/]([^\s]+)/gi)){var a=i[0].split("/");e="Opera|"+i[1]}else e=(i=t.match(/Trident\/7.0/gi))?"Internet Explorer 11":"其它浏览器";return e}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(5),s=i(13),n=i(9),o=i(14),r=i.n(o),c=i(15),l=i.n(c);e.default={name:"list",props:["user"],components:{Comment:r.a,Load:l.a},data:function(){return{replyList:{},show:"",toid:"",pid:"",load:!0,page:0,list:{},datum:{},config:a.a}},created:function(){this.getReplyList(),this.getData();var t=this;s.a.$on("load",function(){t.reload()})},methods:{reload:function(){this.getReplyList(),this.getData()},getReplyList:function(){var t=this,e=$("xy").data("key");n.a.getlist(e).then(function(e){t.replyList=e.body,t.page=t.pageNum(e.body),t.pageData(e.body,1),t.show="",t.load=!1})},formatTime:function(t){var e=new Date(t);return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日 "+e.getHours()+":"+e.getMinutes()},comment:function(t,e,i){this.show===t?this.show="":(this.show=t,this.toid=e,this.pid=i)},dataBack:function(t){for(var e={},i=t.length-1;i>=0;i--)e[t.length-1-i]=t[i];return e},del:function(t){var e=this;n.a.dellist(t).then(function(t){t.body.code?(alert(t.body.msg),e.getReplyList()):console.log(t.body)})},getData:function(){var t=this;n.a.getdata().then(function(e){e.body.code?console.log("UA数据:"+e.body.msg):t.datum=e.body})},countList:function(t){var e=0;for(var i in t)t[i].pId||e++;return e},pageNum:function(t){return Math.ceil(this.countList(t)/5)},pageData:function(t,e){var i=[];this.countList(t);t=this.dataBack(t);for(var a in t)t[a].pId||i.push(t[a]);for(var s=5*(e-1),n=Math.min(5*e-1,i.length-1),o=[],r=s;r<=n;r++)o.push(i[r]);this.list=o,this.num=e}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"load"}},function(t,e,i){"use strict";i.d(e,"a",function(){return c}),i.d(e,"b",function(){return l}),i.d(e,"c",function(){return u}),i.d(e,"d",function(){return d}),i.d(e,"e",function(){return f}),i.d(e,"f",function(){return m}),i.d(e,"g",function(){return p});var a=i(8),s=i(12),n=i(42),o=i.n(n),r=i(5);a.a.use(s.a),a.a.http.options.emulateJSON=!0,a.a.http.interceptors.push(function(t,e){t.headers=t.headers||{};var i=o.a.HmacSHA1("xiaoyi","Xreply").toString();t.headers.set("token",i),e(function(t){401===t.status&&console.log("没有权限"),403===t.status&&console.log("没有权限"),t.ok||console.log("服务器错误")})});var c=a.a.resource(r.a.api+"/api/user"),l=a.a.resource(r.a.api+"/api/user/save"),u=a.a.resource(r.a.api+"/api/reply/get"),d=a.a.resource(r.a.api+"/api/reply/save"),f=a.a.resource(r.a.api+"/api/del"),m=a.a.resource(r.a.api+"/api/datum/save"),p=a.a.resource(r.a.api+"/api/datum/get")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(8),s=i(18),n=i.n(s),o=i(12);a.a.config.productionTip=!1,a.a.use(o.a),new a.a({el:"#xy-reply-app",template:"<App/>",components:{App:n.a}})},,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){i(28);var a=i(6)(i(21),i(33),"data-v-1f6abb4b",null);t.exports=a.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"reply-list"},[t.load?i("load"):t._e(),t._v(" "),t.load?t._e():i("div",{staticClass:"xycount"},[t._v(t._s(t.replyList.length)+"条评论")]),t._v(" "),t._l(t.list,function(e){return e.pId?t._e():i("div",{staticClass:"xylist"},[i("div",{staticClass:"list-left"},[i("a",{attrs:{href:e.fromId.website}},[i("img",{attrs:{src:e.fromId.avatar,alt:""}})])]),t._v(" "),i("div",{staticClass:"list-right"},[i("a",{attrs:{href:e.fromId.website}},[t._v(t._s(e.fromId.nickname))]),t._v(" "),t._l(t.datum,function(a){return e._id==a.cid?i("span",{staticClass:"dat"},[i("span",{staticClass:"os"},[t._v(t._s(a.OS))]),t._v(" "),i("span",{staticClass:"ua"},[t._v(t._s(a.browser))])]):t._e()}),t._v(" "),i("p",{staticClass:"content",domProps:{innerHTML:t._s(e.content)}}),t._v(" "),i("div",{staticClass:"bar"},[i("span",{staticClass:"time"},[t._v(t._s(t.formatTime(e.time)))]),t._v(" "),i("a",{staticClass:"fa fa-reply",on:{click:function(i){t.comment(e._id,e.fromId._id,e._id)}}},[t._v("回复")]),t._v(" "),t.user._id==e.fromId._id||1==t.user.admin?i("a",{staticClass:"fa fa-times",on:{click:function(i){t.del(e._id)}}},[t._v("删除")]):t._e()]),t._v(" "),e._id===t.show?i("comment",{attrs:{user:t.user,toid:t.toid,pid:t.pid},on:{reload:t.reload}}):t._e(),t._v(" "),i("div",{staticClass:"child reply-list"},t._l(t.replyList,function(a){return a.pId===e._id?i("div",{staticClass:"xylist"},[i("div",{staticClass:"list-left"},[i("a",{attrs:{href:a.fromId.website}},[i("img",{attrs:{src:a.fromId.avatar,alt:""}})])]),t._v(" "),i("div",{staticClass:"list-right"},[i("a",{attrs:{href:a.fromId.website}},[t._v(t._s(a.fromId.nickname))]),t._v(" "),t._l(t.datum,function(e){return a._id==e.cid?i("span",{staticClass:"dat"},[i("span",{staticClass:"os"},[t._v(t._s(e.OS))]),t._v(" "),i("span",{staticClass:"ua"},[t._v(t._s(e.browser))])]):t._e()}),t._v(" "),i("p",{staticClass:"content"},[i("a",{attrs:{href:a.toId.website}},[t._v("@"+t._s(a.toId.nickname)+":")]),t._v(" "),i("span",{domProps:{innerHTML:t._s(a.content)}})]),t._v(" "),i("div",{staticClass:"bar"},[i("span",{staticClass:"time"},[t._v(t._s(t.formatTime(a.time)))]),t._v(" "),i("a",{staticClass:"fa fa-reply",on:{click:function(i){t.comment(a._id,a.fromId._id,e._id)}}},[t._v("回复")]),t._v(" "),t.user._id==a.fromId._id||1==t.user.admin?i("a",{staticClass:"fa fa-times",on:{click:function(e){t.del(a._id)}}},[t._v("删除")]):t._e()]),t._v(" "),a._id===t.show?i("comment",{attrs:{user:t.user,toid:t.toid,pid:t.pid},on:{reload:t.reload}}):t._e()],2)]):t._e()}))],2)])}),t._v(" "),i("div",{staticClass:"xy-paginator"},[t.page>1?i("ul",t._l(t.page,function(e){return i("li",{class:{active:e==t.num},on:{click:function(i){t.pageData(t.replyList,e)}}},[t._v(t._s(e))])})):t._e(),t._v(" "),i("a",{attrs:{href:"http://blog.domeyi.com"}},[t._v("Xreply made in XiaoYi")])])],2)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"spinner"},[i("div",{staticClass:"bounce1"}),t._v(" "),i("div",{staticClass:"bounce2"}),t._v(" "),i("div",{staticClass:"bounce3"})])}]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"xy-reply-app"}},[i("div",{staticClass:"xybs"},[t.user._id?[i("a",{attrs:{href:t.user.website}},[t._v(t._s(t.user.nickname))]),t._v(" "),1==t.user.admin?i("a",{attrs:{href:"#"}},[t._v("管理")]):t._e(),t._v(" "),i("a",{on:{click:t.logout}},[t._v("退出")])]:[i("a",{on:{click:t.switchLogin}},[t._v("注册")]),t._v(" "),i("a",{on:{click:t.login}},[t._v("登录")])]],2),t._v(" "),i("comment",{attrs:{user:t.user}}),t._v(" "),i("list",{attrs:{user:t.user}}),t._v(" "),i("transition",{attrs:{name:"bounce"}},[t.show?i("div",{staticClass:"xy-login"},[i("div",{staticClass:"login-header"},[i("h5",[t._v("注册")]),t._v(" "),i("i",{staticClass:"fa fa-times close",attrs:{"aria-hidden":"true"},on:{click:t.switchLogin}})]),t._v(" "),i("div",{staticClass:"login-body"},[i("div",{staticClass:"ts"},[t._v("第一次在本站评论需注册，下次评论只需登录即可。")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],class:{errorClass:t.isMail},attrs:{type:"text",name:"email",placeholder:"邮箱"},domProps:{value:t.email},on:{input:function(e){e.target.composing||(t.email=e.target.value)}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.website,expression:"website"}],class:{errorClass:t.isSite},attrs:{type:"text",name:"website",placeholder:"网站(http://)"},domProps:{value:t.website},on:{input:function(e){e.target.composing||(t.website=e.target.value)}}}),t._v(" "),i("button",{on:{click:t.register}},[t._v("注册并关联QQ")])])]):t._e()])],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"xycomment"},[i("div",{staticClass:"xycomment-left"},[i("a",{attrs:{href:t.user.website||t.config.myWebstie}},[i("img",{attrs:{src:t.user.avatar||t.config.anonymous,alt:""}})])]),t._v(" "),i("div",{staticClass:"xycomment-right"},[t.disabled?i("load",{staticClass:"load"}):t._e(),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{placeholder:t.config.placeholder,disabled:t.disabled},domProps:{value:t.content},on:{blur:function(e){t.autoTextarea(e)},keydown:function(e){t.autoTextarea(e)},keyup:function(e){t.autoTextarea(e)},focus:function(e){t.autoTextarea(e)},input:function(e){e.target.composing||(t.content=e.target.value)}}}),t._v(" "),i("button",{attrs:{disabled:t.disabled},on:{click:function(e){t.reply()}}},[i("i",{staticClass:"fa fa-paper-plane-o fa-2x",attrs:{"aria-hidden":"true"}})])],1)])},staticRenderFns:[]}},,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){}],[24]);
//# sourceMappingURL=app.2f5212db331af1ebb7a2.js.map